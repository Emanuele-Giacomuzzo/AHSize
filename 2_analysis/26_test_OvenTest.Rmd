---
title: "OvenTest"
author: "Emanuele Giacomuzzo"
date: "2022-08-05"
output: html_document
editor_options: 
  chunk_output_type: console
---

To disturb ecosystems in the past experiment (PatchSize), we inserted ecosystem sub-samples into 50-ml falcon tubes (here called "tubes"), inserted tubes into a tube rack, and then microwaved the rack. However, this process is time demanding. Here, we explore the possibility of (i) using a laboratory oven to replace the microwave and (ii) whether it would be more appropriate to use tubes or 250-ml Schott bottles (here called "bottles"); which were tested by measuring heating and evaporation rates of deionised water in tubes or bottles. I put into a 90 °C oven tubes with 7.5 or 37.5 ml water and bottles with 200 ml water (see lab book for how fast they heated up), all replicated ten-fold,and measured the temperature of one replicate every 30 minutes. The container whose temperature was measured was set aside and another replicate was measured the following 30 minutes. After 125 minutes, I took all the remaining replicates and measured their evaporation, without letting them cool down. Then, I repeated the process but increasing the oven temperature to 100 °C, measuring containers every 20 minutes, and measuring evaporation rates after 90 minutes.

```{r warning=FALSE}

colour_90_degrees = "#4daf4a"
colour_100_degrees = "#e41a1c"

colour_7.5_tubes = "#d8b365"
colour_37.5_tubes = "#5ab4ac"

ds_OvenTest_1 = read.csv(here("1_data", "tests", "OvenTest", "OvenTest1_data.csv"), header = TRUE) %>%
  mutate(water_initial_weight = tube_n_water_weight - tube_weight) %>%
  mutate(evaporation_weight = water_initial_weight - water_after_oven_weight) %>%
  mutate(oven_temperature = as.character(oven_temperature))
  
ds_OvenTest_1$treatment = paste(ds_OvenTest_1$container, ds_OvenTest_1$water_pipetted, 'ml')
ds_OvenTest_1oven_temperature = factor(ds_OvenTest_1$oven_temperature,levels=c('90 °C for 125 minutes', '100 °C for 90 minutes'))
ds_OvenTest_1$treatment = factor(ds_OvenTest_1$treatment,levels=c('tube 7.5 ml', 'tube 37.5 ml', 'bottle 200 ml'))

ds_OvenTest_1 %>%
  filter (taken_out_early == "no") %>%
  drop_na(evaporation_weight) %>%
  mutate(oven_temperature = factor(oven_temperature,
                                   levels = c("90 °C for 125 minutes",
                                              "100 °C for 90 minutes"))) %>%
  ggplot (aes(x = treatment,
              y = evaporation_weight,
              fill = oven_temperature)) +
  geom_boxplot() +
  scale_fill_manual(values = c(colour_90_degrees, 
                               colour_100_degrees)) +
  labs(x = "",
       y = "Water evaporation (g)",
       fill = "") +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = legend_position,
        legend.key.width = unit(legend_width_cm, "cm"))
```

After presenting the results to Florian, we agreed to use falcon tubes-as they occupy less space-and to remeasure evaporation and heating rates to make sure that there isn't too much variation across replicates. Therefore, I conducted another test: four 25-tube racks were put into a **[[write how hot the oven was]{.underline}]** °C oven for 105 minutes. Two racks with tubes with 7.5 ml water and the other two with tubes with 37.5 ml water. After 30 minutes and 60 minutes I checked the temperature of 5 tubes (4 in the corners, 1 in the centre) of each rack. After 105 minutes, I checked the water evaporation of the remaning tubes (after letting the tubes cool down for around 90 minutes). The following plots show how fast tubes heated up and evaporated.

```{r ,warning=FALSE}
ds_OvenTest_2 = read.csv(here("1_data", "tests", "OvenTest", "OvenTest2_data.csv"), header = TRUE) %>%
  mutate(weight_water_beginning = tube_n_water_weight - tube_weight) %>%
  mutate(evaporation_weight = weight_water_beginning - water_weight_after_heating)

ds_OvenTest_2 %>%
  rename("30" = temperature_after_30_min) %>%
  rename("60" = temperature_after_60_min) %>%
  pivot_longer(7:8, names_to = "time", values_to = "temperature") %>%
  mutate(water_volume_added = factor(water_volume_added, 
                                     levels = c("7.5", "37.5"),
                                     ordered = TRUE)) %>%
  drop_na(temperature) %>%
  ggplot(aes(x = time, 
             y = temperature,
             fill = water_volume_added)) + 
  geom_boxplot() +
  scale_fill_manual(values = c(colour_7.5_tubes, colour_37.5_tubes)) +
  labs(x = "Time (min)", 
       y = "Temperature (°C)",
       fill='Water volume (ml)') +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = legend_position,
        legend.key.width = unit(legend_width_cm, "cm"))
```

```{r}
ds_OvenTest_2 %>% 
  drop_na(evaporation_weight) %>%
  mutate(water_volume_added = factor(water_volume_added, 
                                     levels = c("7.5", "37.5"),
                                     ordered = TRUE)) %>%
  ggplot(aes(x = as.factor(water_volume_added), 
             y = evaporation_weight,
             fill = as.factor(water_volume_added))) + 
  labs(x = "Ecosystem volume (ml)", 
       y = "Evaporation (ml)") + 
  geom_boxplot() +
  scale_fill_manual(values = c(colour_7.5_tubes, colour_37.5_tubes)) +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "none",
        legend.key.width = unit(legend_width_cm, "cm"))
```

These results show us how much water was lost after heating it up in the oven and pouring it into a Becker to measure it. However, it can be that some of the water was lost because it got stuck to the walls of the tube and could not be retrieved. To find out how much water is left in the tube after the pouring, I performed an additional test. I filled tubes with 7.5 or 37.5 ml, weighed the water inside, poured the water out, and reweighed the water inside.

```{r}
ds_PooringTest = read.csv(here("1_data", "tests", "PooringTest.csv"), header = TRUE) 

ds_PooringTest%>%
  mutate(left_in_tube = tube_after_water_g - tube_g,
         water_in_tube_ml = factor(water_in_tube_ml, 
                                     levels = c("7.5", "37.5"),
                                     ordered = TRUE)) %>%
  ggplot(aes(x = reorder(water_in_tube_ml, sort(as.numeric(water_in_tube_ml))),
             y = left_in_tube,
             fill = water_in_tube_ml)) +
  geom_boxplot() + 
  scale_fill_manual(values = c(colour_7.5_tubes, colour_37.5_tubes)) +
  labs(x = "Water in and out tube (ml)",
       y = "Water in tube after pooring (g)") + 
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position = "none",
        legend.key.width = unit(legend_width_cm, "cm"))
```
